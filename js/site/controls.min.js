var sh = $("#second_header"), fh = $("#first_header"), th = $("#third_header"), om = $(".o-menu"), jhf = $(".jonkey-hfix-pos");
fh_dim = (fh.length > 0) ? fh[0].clientHeight + fh.offset().top : 0,
sh_dim = (sh.length > 0) ? sh[0].clientHeight + sh.offset().top : 0,
spos = 0,
startpos = 0,
lastY = 0,lastX = 0;

$("head").children(".fx-mfix").remove();
$("head").append("<style class='fx-mfix'> .jonkey-hfix-pos.active + #first_header { padding-bottom: " + (sh_dim - fh_dim) + "px; } </style>");

$(document).ready(function(){

    handleHeaderFix(); //Fix header on initial page load

    handleSliderResize(); //Fix element width before resize

    $(window).on("scroll", function(){
        handleHeaderFix();
    }); //Fix header when scrolling

    $(document).on("click", ".drop-btn", function(e){
        e.stopPropagation();
        $(".hiddible").hide();

        var $dis = $(this);
        if($dis.hasClass("dnext")){
            if($dis.hasClass("dfx")){
                $dis.next(".drop-child-item").addClass("marto").css({"display" : "flex", "display" : "-webkit-flex"});
                setTimeout(function(){
                    $dis.next(".drop-child-item").removeClass("marto");
                }, 150);
            }
            else{
                $dis.next(".drop-child-item").addClass("marto").show(0, function(){
                    $dis.next(".drop-child-item").removeClass("marto");
                });
            }
        }
        else{
            if($dis.hasClass("dfx")){
                $dis.find(".drop-child-item").first().addClass("marto").css({"display" : "flex", "display" : "-webkit-flex"});
                setTimeout(function(){
                    $dis.find(".drop-child-item").removeClass("marto");
                }, 150);
            }
            else{
                $dis.find(".drop-child-item").first().addClass("marto").show(0, function(){
                    $dis.find(".drop-child-item").removeClass("marto");
                });
            }
        }
    });

    $(document).click(function(){
        $(".hiddible").hide();
    });

    $(document).on("click", ".drop-child-item", function(e){
        e.stopPropagation();
    });

    $(document).on("click", ".go-to-top", function(e){
        $("html, body").animate({
			scrollTop: 0
		}, 500);
    });

    $(window).resize(function(){
        handleSliderResize(); //Get width on resize
    });
	
	$(document).on("click", ".closer-btn", function(){
		var $dis = $(this);
		$dis.closest(".closer-parent").hide(0, function(){
			if($dis.hasClass("m-over")){
				$("body, html").css("overflow", "hidden").css("overflow-y", "auto");
			}
		});	
	});
	
	$(document).on("touchmove", ".prev-mm, .stopprop", function(e){
		e.preventDefault();
	});

	$(document).on("click", ".account-dbtn", function(e){
		if($(window).innerWidth() <= 500){
			$("body, html").animate({
				scrollTop: 0,
			}, 500, function(){
				$("body, html").css("overflow", "hidden");
			});	
		}
	});

	$(document).on("click", ".site-link-btn", function(e){
		var link = $(this).attr("data-href"), target = $(this).attr("data-target");
		window.open(link, target);
	});

	$(document).on("click", ".show-filters", function(e){
		$(".search-cat-list").toggle();
	});

	$(document).on("click", ".toggle-chat-btn", function(e){
		var $this = $(this), state = $this.attr("data-chat-state"); 
		switch(state){
			case "hidden":
				$(".live-chat-container").removeClass("hidden");
				$(".toggle-chat-btn").attr("data-chat-state", "shown");
				$(".tcb-cnt").html("<i class='icon-cross2'></i>");
				break;
			default:
				$(".live-chat-container").addClass("hidden");
				$(".toggle-chat-btn").attr("data-chat-state", "hidden");
				$(".tcb-cnt").html("<i class='icon-arrow-up32'></i>");
		}
	});

});

function handleHeaderFix(){
    if($(window).scrollTop() >= fh_dim){
        sh.addClass("fixed-header");
        jhf.addClass("active");
		om.show();
    }
    else{
        sh.removeClass("fixed-header");
        jhf.removeClass("active");
		om.hide();
    }
	if($(window).scrollTop() >= $(window).innerHeight()){
		$(".go-to-top").removeClass("hidden");
	}
	else{
		$(".go-to-top").addClass("hidden");
	}
}

function elemTouchStart(t,event){
	startpos = t.scrollLeft + event.touches[0].pageX;
}
				
function elemTouchMove(t,event){
	t.scrollLeft = startpos - event.touches[0].pageX;
	var currentY = event.originalEvent.touches[0].clientY;
	var currentX = event.originalEvent.touches[0].clientX;

	if(currentY > lastY){
         // moved down
    }else if(currentY < lastY){
         // moved up
    }
	
	if(currentX > lastX){
         event.preventDefault();
    }else if(currentX < lastX){
         event.preventDefault();
    }
	
    lastY = currentY;
    lastX = currentX;
}

function elemTouchStartY(t,event){
	startpos = t.scrollTop + event.touches[0].pageY;
}
				
function elemTouchMoveY(t,event){
	t.scrollTop = startpos - event.touches[0].pageY;
	event.preventDefault();
}

function sendAlert(d){
	$(".alert-message").html(d);
	$(".alert-container").show();
}

